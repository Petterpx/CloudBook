# ViewPager2å®ç°å†…éƒ¨Itemçš„åŠ¨æ€æ»šåŠ¨



## éœ€æ±‚å†³å®šèµ·å› 

æœ€è¿‘æ¥åˆ°äº†ä¸€ä¸ªéœ€æ±‚ï¼Œå¤§æ¦‚ç±»ä¼¼å¦‚ä¸‹å›¾æ‰€ç¤ºçš„ä¸€ä¸ªæ ·å¼(çœç•¥äº†éƒ¨åˆ†ç»†èŠ‚ï¼Œä¸å½±å“å¤§æ¦‚)ã€‚

<img src="https://tva1.sinaimg.cn/large/008eGmZEly1gmxfokv1z8j312k0u0jtz.jpg" alt="image-20210123104608972" style="zoom: 50%;" />

æˆ‘ä»¬è¿™æ˜¯ä¸€ä¸ªè§†é¢‘æ’­æ”¾é¡µ+è¯¦æƒ…é¡µï¼Œè€ƒè™‘åˆ°ç®€å•å¿«æ·ï¼Œå°±æƒ³åˆ°äº†ä¸€ä¸ª `ViewPager2` å°±å¯ä»¥å®ç°ï¼Œç®€å•åˆå¿«æ·ï¼Œä¸ºè‡ªå·±ç‚¹èµã€‚ä¸€æƒ³åˆ°å¦‚æ­¤easy,ç¬æ—¶ç¬‘å‡ºäº†çŒªå«ã€‚å½“ç„¶RecyclerViewä¹Ÿå¯ä»¥ï¼Œç”¨ä¸€ä¸ªä»¿æŠ–éŸ³çš„é‚£ç§ `LayoutManager` å°±è¡Œï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆä¸å‘¢ï¼Œå› ä¸ºæ¶‰åŠåˆ°äº†è§†é¢‘æ’­æ”¾ï¼Œæ‰‹åŠ¨å»å¤„ç†ä¸€äº›ç”Ÿå‘½å‘¨æœŸå’Œæ‡’åŠ è½½ï¼Œæ€»æ˜¯éå¸¸éº»çƒ¦ï¼Œè€Œä¸”ViewPager2æœ¬èº«å°±æ˜¯åŸºäº `RecyclerView` ,æ‰€ä»¥ä½•ä¹è€Œä¸ä¸ºå‘¢ã€‚

å½“ç„¶æœ‰äº›åŒå­¦ä¼šè¯´äº†ï¼Œè¿™ä¸ªç©æ„è‡ªå®šä¹‰ä¸€ä¸ªå¯æ»‘åŠ¨çš„ViewGroupå°±è¡Œå•Šï¼Œè¿™ä¸ªæ–¹æ¡ˆä¹Ÿå¯ä»¥ã€‚ä½†æ˜¯é¦–å…ˆä½ è¦è€ƒè™‘çš„ä¸œè¥¿å°±å¾ˆå¤šï¼Œå¦‚æœè§†é¢‘è¯¦æƒ…é¡µè¶…å‡ºä¸€å±å‘¢ï¼Œä¹Ÿå°±æ˜¯å†…éƒ¨ç”¨äº† **RecyclerViewæˆ–è€…NestedScrollView** å‘¢ï¼Œæ˜¯ä¸æ˜¯è¿˜éœ€è¦å¤„ç†ä¸€ä¸‹æ»‘åŠ¨å†²çªï¼Œå½“ç„¶è¿™ä¹Ÿä¸æ˜¯å¾ˆå›°éš¾,å†…éƒ¨æ‹¦æˆªæ³•å°±å¯ä»¥æå®šã€‚ç„¶åå†™å®Œåï¼Œç›¸åº”çš„åŠ è½½å›è°ƒæ˜¯ä¸æ˜¯å¾—è‡ªå·±å†æ‰‹åŠ¨å®šä¹‰ä¸€ä¸ªæ¥å£å»ä¼ªé€ ã€‚æ¯”å¦‚ä¸å¯è§ï¼Œé¡µé¢åŠ è½½ï¼Œæ€»ä½“ç›¸å¯¹æ¥è¯´å¹¶ä¸æ˜¯é‚£ä¹ˆå®¹æ˜“ã€‚



å°±åœ¨æˆ‘ä»¥ä¸ºåˆå¯ä»¥æ‘¸é±¼ä¸€ä¸ªViewPager2å°±å¯ä»¥æå®šä¹‹æ—¶ã€‚çªç„¶ï¼Œäº§å“åŒå­¦å‘äº†æ–°æŒ‡ç¤ºï¼Œä¸‹æ„è¯†é¢„æ„Ÿä¸å¦™ã€‚

äº§å“ï¼šå¾—åŠ ä¸€ä¸ªç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶çš„æç¤ºå•Šï¼Œè¦ä¸ç„¶ç”¨æˆ·éƒ½ä¸çŸ¥é“é¡µé¢å¯ä»¥ä¸‹æ»‘å‘¢ï¼Ÿæ•ˆæœæˆ‘å‘ä½ äº†ï¼Œä½ çœ‹çœ‹ï¼š

> ä¸‹å›¾ä¸ºæˆ‘å®ç°å¥½çš„ç®€å•æ ·å¼ï¼Œå¤§æ„ä½“ä¼šå³å¯ã€‚

<img src="https://tva1.sinaimg.cn/large/008eGmZEly1gmxg4c6ovrg30c00om1kz.gif" alt="Jan-23-2021 11-00-49" style="zoom:50%;" />

å¥½å®¶ä¼™ï¼Œä¸æŒ‰å¥—è·¯å‡ºç‰Œå•Šï¼Œæˆ‘æ•…ä½œæ·±æ²‰ï¼Œå®åˆ™ç¨³å¦‚è€ç‹—( ViewPager2 ä¸æ˜¯æœ‰ä¸€ä¸ª `fakeDragBy()` æ–¹æ³•è®¾ç½®åç§»é‡å—)ï¼Œè¿™ä¸ªæœ‰ç‚¹éº»çƒ¦ï¼Œæˆ‘å¾—è€ƒè™‘è€ƒè™‘ã€‚

æ¥ä¸‹æ¥ä¸å´çŸ¥é“è‡ªå·±è¦å¼€å¯äº†å•ªå•ªæ‰“è„¸æ—¶åˆ»ï¼Œæ»¡å¿ƒæ¬¢å–œï¼Œå¤ªeasyå•Šï¼ŒViewPager2 çœŸé¦™ğŸ¤£ï¼



## æ‰“è„¸æ—¶åˆ»

äºæ˜¯ç†Ÿç»ƒçš„å¼€åˆ†æ”¯ï¼Œåˆ‡åˆ†æ”¯ï¼Œå†™demoï¼Œè°ƒç”¨æ–¹æ³•ï¼Œèµ°èµ·ï¼

å…ˆçœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ã€‚

**fakeDragBy()**

> ç”¨äºæ¨¡æ‹Ÿæ‰‹æŒ‡æ‹–åŠ¨æ•ˆæœï¼Œéœ€è¦å…ˆè°ƒç”¨ `beginFakeDrag()` å¼€å¯ï¼Œç»“æŸåï¼Œéœ€è¦è°ƒç”¨ `endFakeDrag()` å…³é—­ã€‚

æ—¢ç„¶æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¸å°±å¾ˆç®€å•å—ï¼Œä¼ªä»£ç å¦‚ä¸‹ï¼š

![image-20210123113905769](https://tva1.sinaimg.cn/large/008eGmZEly1gmxh7mag2rj31cc0fon0v.jpg)

æŸ¥çœ‹æ•ˆæœå¦‚ä¸‹ï¼š

|                             ç¤ºä¾‹                             |                                                              |
| :----------------------------------------------------------: | :----------------------------------------------------------- |
| <img src="https://tva1.sinaimg.cn/large/008eGmZEly1gmxgzd46hmg30c00omhdv.gif" alt="Jan-23-2021 11-30-53" style="zoom:50%;" /> | ![æˆ‘ä»–å¦ˆç›´æ¥è£‚å¼€_ç›´æ¥_è£‚å¼€è¡¨æƒ…](https://tva1.sinaimg.cn/large/008eGmZEly1gmxh0acs0aj30c80c774o.jpg) |

æˆ‘è£‚å¼€äº†ğŸ˜¨ï¼Œä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Œæˆ‘å°±å±æ€§åŠ¨ç”»é‡Œè°ƒäº†ä¸€ä¸‹è€Œå·²ï¼Œå»çœ‹ä¸€ä¸‹æºç ã€‚

**ViewPager2.fakeDragBy(x)**

![image-20210123113813708](https://tva1.sinaimg.cn/large/008eGmZEly1gmxh6q61v2j31ai0r647v.jpg)

å†…éƒ¨æœ€ç»ˆæ˜¯è°ƒç”¨äº†RecyclerViewçš„ `scrollBy()` ï¼Œä¹Ÿå°±æ˜¯ç›¸å¯¹æ»‘åŠ¨,å“¦åŸæ¥å¦‚æ­¤ï¼Œéš¾æ€ªè°ƒäº†ä¸€ä¸‹ï¼Œæ»‘äº†è¿™ä¹ˆè¿œã€‚

## è§£å†³æ–¹æ³• 

æ—¢ç„¶å¦‚æ­¤ï¼ŒViewPager2æ˜¯åŸºäºRecyclerViewï¼Œé‚£ä¹ˆæˆ‘å»è°ƒç”¨RecyclerViewæ»šåŠ¨ä¸å°±è¡Œå—ï¼Œæ€è·¯å¦‚ä¸‹ï¼š

1. ViewPager2-> RecyclerView, RecyclerViewé»˜è®¤æ˜¯ç§æœ‰çš„ï¼Œå¯ä»¥é€šè¿‡`åå°„`æˆ–è€… **getChildAt(0)** è·å–
2. RecyclerViewä¸æ”¯æŒ **scrollTo()** ,å¯ä»¥é€šè¿‡ `LinearLayouManager` å»æ»šåŠ¨
3. LinearLayoutManager-`scrollToPositionWithOffset()` æ”¯æŒæ»šåŠ¨åˆ°åç§»ä½ç½®

ä¼ªä»£ç å¦‚ä¸‹ï¼š

```kotlin
val layoutManager = (getChildAt(0) as? RecyclerView
        ?: return@apply).layoutManager as? LinearLayoutManager ?: return@apply
val oneAnimator = ValueAnimator.ofFloat(0f, -450f).apply {
    duration = 500
}
oneAnimator.addUpdateListener {
    layoutManager.scrollToPositionWithOffset(0, it.animatedValue as Int)
}
oneAnimator.start()
```

æ•ˆæœå¦‚æœ€ä¸Šé¢ç¤ºä¾‹gifæ‰€ç¤ºï¼Œè¿™æ ·å°±è§£å†³äº†ViewPager2-itemåŠ¨æ€æ»šåŠ¨é—®é¢˜ã€‚



## éœ€è¦æ³¨æ„çš„ç‚¹

å°±å¦‚æˆ‘ä¸Šé¢æœ€å¼€å§‹åˆ†ææ—¶æ‰€è¿°ï¼Œå¦‚æœè¯¦æƒ…é¡µæ˜¯å¯æ»‘åŠ¨çš„ï¼Œé‚£ä¹ˆå°±å¿…é¡»å¤„ç†ä¸€ä¸‹æ»‘åŠ¨å†²çªï¼Œç›¸åº”çš„æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œä½¿ç”¨å†…éƒ¨æ‹¦æˆªæ³•ï¼Œè®©æ»‘åŠ¨çš„Viewä¼˜å…ˆè·å¾—äº‹ä»¶å³å¯ï¼Œå½“å¤„äºæ»‘åŠ¨Viewé¡¶éƒ¨æ—¶ï¼Œå†å°†äº‹ä»¶è¿˜ç»™çˆ¶View.

![image-20210123133854397](https://tva1.sinaimg.cn/large/008eGmZEly1gmxkoagmo4j31ap0u0jzf.jpg)



## åç»­

å½“ç„¶ç”¨ViewPager2å»å†™ä»ç„¶æœ‰ç§å¤§æå°ç”¨çš„æ„Ÿè§‰ï¼Œæ¯•ç«Ÿåªæœ‰ä¸¤ä¸ªitem,æ‰€ä»¥ï¼Œæ¯”è¾ƒå¥½çš„æ–¹å¼ä¾ç„¶æ˜¯ä½¿ç”¨è‡ªå®šä¹‰çš„æ»‘åŠ¨ViewGroupå®ç°ï¼Œæ‰€ä»¥æˆ‘ä¼šåœ¨ä¸‹ç¯‡åšå®¢æ¥ä»¥ä¸€ä¸ªè‡ªå®šä¹‰çš„æ–¹å¼æ¥è§£å†³æ­¤é—®é¢˜ã€‚

